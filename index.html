<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pr√°ctica de Verbos en Euskera</title>

  <style>
    /* Reset b√°sico */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background: #f5f7fa;
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1, h2 {
      margin-bottom: 20px;
      color: #2c3e50;
      text-align: center;
    }
    .hidden { display: none; }
    #login-register, #menu, #exercise, #errors, #study {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 20px;
      width: 320px;
      max-width: 95vw;
      margin-bottom: 20px;
    }
    form {
      display: flex;
      flex-direction: column;
    }
    label {
      margin-bottom: 5px;
      font-weight: 600;
      color: #34495e;
    }
    input[type="email"], input[type="password"], input[type="text"] {
      padding: 8px 12px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      transition: border-color 0.3s ease;
    }
    input[type="email"]:focus, input[type="password"]:focus, input[type="text"]:focus {
      outline: none;
      border-color: #2980b9;
    }
    button, input[type="submit"] {
      background-color: #2980b9;
      color: white;
      border: none;
      padding: 10px 15px;
      margin-top: 8px;
      border-radius: 5px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover, input[type="submit"]:hover {
      background-color: #1f618d;
    }
    button.secondary {
      background-color: #95a5a6;
      margin-left: 10px;
    }
    button.secondary:hover {
      background-color: #7f8c8d;
    }
    .feedback {
      font-size: 0.9rem;
      margin-top: -10px;
      margin-bottom: 15px;
      color: #e74c3c;
      min-height: 18px;
    }
    .feedback.correct {
      color: #27ae60;
    }
    .password-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }
    .password-wrapper input {
      flex-grow: 1;
    }
    .password-wrapper button {
      position: absolute;
      right: 8px;
      background: none;
      border: none;
      cursor: pointer;
      color: #2980b9;
      font-size: 1.1rem;
      padding: 0;
    }
    #menu p {
      margin-bottom: 15px;
      font-weight: 600;
      text-align: center;
      font-size: 1.1rem;
    }
    #menu button {
      width: 100%;
      margin-bottom: 10px;
    }
    #exercise #question {
      font-size: 1.2rem;
      margin-bottom: 15px;
      text-align: center;
      font-weight: 600;
      color: #2c3e50;
      white-space: pre-line;
    }
    #exercise input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      margin-bottom: 12px;
    }
    #feedback {
      min-height: 24px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 15px;
    }
    #feedback.correct {
      color: #27ae60;
    }
    #feedback.incorrect {
      color: #e74c3c;
    }
    #errorList {
      list-style: inside disc;
      color: #34495e;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
      font-size: 0.95rem;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #2980b9;
      color: white;
    }
    tbody tr:nth-child(even) {
      background-color: #f9f9f9;
    }
  </style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB8-aTOwO8w21ig0L21kfEded05ewEG3Wc",
      authDomain: "verboseuskeraapp.firebaseapp.com",
      projectId: "verboseuskeraapp",
      storageBucket: "verboseuskeraapp.appspot.com",
      messagingSenderId: "1002538902447",
      appId: "1:1002538902447:web:b6d1f2795fef697d22c55a",
      measurementId: "G-83R58Q7B8J"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
  </script>
</head>
  <section id="study" class="hidden" aria-live="polite" style="max-width: 600px; margin: auto; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 20px;">
  <h2>Tabla de Conjugaciones</h2>
  <table>
    <thead>
      <tr>
        <th>Pronombres</th>
        <th>Presente (izan)</th>
        <th>Pasado (izan)</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>nik ‚Üí zuri</td><td>dizut</td><td>nizon</td></tr>
      <tr><td>nik ‚Üí hari</td><td>diot</td><td>nizon</td></tr>
      <tr><td>nik ‚Üí zuei</td><td>dizuet</td><td>nizon</td></tr>
      <tr><td>nik ‚Üí haiei</td><td>diet</td><td>nizon</td></tr>
      <tr><td>zuk ‚Üí niri</td><td>didazu</td><td>zinen</td></tr>
      <tr><td>zuk ‚Üí hari</td><td>diozu</td><td>zinen</td></tr>
      <tr><td>zuk ‚Üí guri</td><td>diguzu</td><td>ginen</td></tr>
      <tr><td>zuk ‚Üí haiei</td><td>diezu</td><td>zinen</td></tr>
      <tr><td>hark ‚Üí niri</td><td>dit</td><td>zen</td></tr>
      <tr><td>hark ‚Üí zuri</td><td>dit</td><td>zen</td></tr>
    </tbody>
  </table>
  <button onclick="showMenu()" class="secondary">Volver al Men√∫</button>
</section>

<body>

  <h1>Pr√°ctica de Verbos en Euskera</h1>

  <section id="login-register">
    <form id="loginForm" onsubmit="return loginUser(event)">
      <h2>Iniciar sesi√≥n</h2>
      <label for="loginUsername">Correo electr√≥nico</label>
      <input type="email" id="loginUsername" required placeholder="tu@email.com" />
      <label for="loginPassword">Contrase√±a</label>
      <div class="password-wrapper">
        <input type="password" id="loginPassword" required placeholder="Contrase√±a" />
        <button type="button" title="Mostrar contrase√±a" onclick="togglePassword('loginPassword', this)">üëÅÔ∏è</button>
      </div>
      <input type="submit" value="Entrar" />
      <p class="feedback" id="loginFeedback"></p>
      <p>¬øNo tienes cuenta? <button type="button" onclick="showRegister()" class="secondary">Reg√≠strate</button></p>
    </form>

    <form id="registerForm" class="hidden" onsubmit="return registerUser(event)">
      <h2>Registrarse</h2>
      <label for="registerUsername">Correo electr√≥nico</label>
      <input type="email" id="registerUsername" required placeholder="tu@email.com" />
      <label for="registerPassword">Contrase√±a</label>
      <div class="password-wrapper">
        <input type="password" id="registerPassword" required placeholder="Contrase√±a" />
        <button type="button" title="Mostrar contrase√±a" onclick="togglePassword('registerPassword', this)">üëÅÔ∏è</button>
      </div>
      <label for="registerPasswordConfirm">Confirmar contrase√±a</label>
      <div class="password-wrapper">
        <input type="password" id="registerPasswordConfirm" required placeholder="Repite la contrase√±a" />
        <button type="button" title="Mostrar contrase√±a" onclick="togglePassword('registerPasswordConfirm', this)">üëÅÔ∏è</button>
      </div>
      <input type="submit" value="Registrar" />
      <p class="feedback" id="registerFeedback"></p>
      <p>¬øYa tienes cuenta? <button type="button" onclick="showLogin()" class="secondary">Inicia sesi√≥n</button></p>
    </form>
  </section>

  <section id="menu" class="hidden">
    <p>¬°Bienvenido! Selecciona una opci√≥n:</p>
    <button onclick="startExercise()">Practicar Conjugaciones</button>
    <button onclick="showErrors()">Mostrar Errores</button>
    <button onclick="showStudy()">Ver Tabla de Conjugaciones</button> <!-- NUEVO BOT√ìN -->
    <button onclick="logout()">Cerrar sesi√≥n</button>
  </section>


  <section id="exercise" class="hidden" aria-live="polite">
    <h2>Ejercicio de Conjugaci√≥n</h2>
    <div id="question"></div>
    <form id="answerForm" onsubmit="return checkAnswer(event)">
      <input type="text" id="answerInput" placeholder="Escribe la conjugaci√≥n correcta" autocomplete="off" required />
      <input type="submit" value="Comprobar" />
    </form>
    <div id="feedback" role="alert"></div>
    <button id="nextButton" class="hidden" onclick="nextQuestion()">Siguiente</button>
    <button onclick="showMenu()" class="secondary">Volver al Men√∫</button>
  </section>

  <section id="errors" class="hidden" aria-live="polite">
    <h2>Errores Cometidos</h2>
    <ul id="errorList"></ul>
    <button onclick="clearErrors()">Borrar Errores</button>
    <button onclick="showMenu()" class="secondary">Volver al Men√∫</button>
  </section>

  <script>
    // Elementos
    const loginRegisterSection = document.getElementById('login-register');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const loginFeedback = document.getElementById('loginFeedback');
    const registerFeedback = document.getElementById('registerFeedback');
    const menuSection = document.getElementById('menu');
    const exerciseSection = document.getElementById('exercise');
    const questionDiv = document.getElementById('question');
    const answerForm = document.getElementById('answerForm');
    const answerInput = document.getElementById('answerInput');
    const feedbackDiv = document.getElementById('feedback');
    const nextButton = document.getElementById('nextButton');
    const errorsSection = document.getElementById('errors');
    const errorList = document.getElementById('errorList');
    const studySection = document.getElementById('study');

    function showStudy() {
      menuSection.classList.add('hidden');
      exerciseSection.classList.add('hidden');
      errorsSection.classList.add('hidden');
      studySection.classList.remove('hidden');
    }
    
    function hideStudy() {
      studySection.classList.add('hidden');
    }


    // Firebase auth handlers
    function loginUser(e) {
      e.preventDefault();
      loginFeedback.textContent = "";
      const email = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value.trim();

      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          loginRegisterSection.classList.add('hidden');
          menuSection.classList.remove('hidden');
          loginForm.reset();
        })
        .catch(error => {
          loginFeedback.textContent = "Error: " + error.message;
        });
      return false;
    }

    function registerUser(e) {
      e.preventDefault();
      registerFeedback.textContent = "";
      const email = document.getElementById('registerUsername').value.trim();
      const password = document.getElementById('registerPassword').value.trim();
      const confirmPassword = document.getElementById('registerPasswordConfirm').value.trim();

      if (password !== confirmPassword) {
        registerFeedback.textContent = "Las contrase√±as no coinciden";
        return false;
      }
      if (password.length < 6) {
        registerFeedback.textContent = "La contrase√±a debe tener al menos 6 caracteres";
        return false;
      }

      auth.createUserWithEmailAndPassword(email, password)
        .then(() => {
          registerFeedback.textContent = "Usuario registrado, por favor inicia sesi√≥n.";
          registerForm.reset();
          showLogin();
        })
        .catch(error => {
          registerFeedback.textContent = "Error: " + error.message;
        });
      return false;
    }

    function logout() {
      auth.signOut().then(() => {
        menuSection.classList.add('hidden');
        exerciseSection.classList.add('hidden');
        errorsSection.classList.add('hidden');
        loginRegisterSection.classList.remove('hidden');
      });
    }

    function showRegister() {
      loginForm.classList.add('hidden');
      registerForm.classList.remove('hidden');
      loginFeedback.textContent = "";
      registerFeedback.textContent = "";
    }

    function showLogin() {
      loginForm.classList.remove('hidden');
      registerForm.classList.add('hidden');
      loginFeedback.textContent = "";
      registerFeedback.textContent = "";
    }

    function togglePassword(inputId, btn) {
      const input = document.getElementById(inputId);
      if (input.type === "password") {
        input.type = "text";
        btn.textContent = "üôà";
      } else {
        input.type = "password";
        btn.textContent = "üëÅÔ∏è";
      }
    }

    // Datos verbales - estructura con pares de pronombres como claves (string con guion)
    const s_present = {
      'izan': {
        'nik-zuri': ['dizut', 0],
        'nik-hari': ['diot', 0],
        'nik-zuei': ['dizuet', 0],
        'nik-haiei': ['diet', 0],
        'zuk-niri': ['didazu', 0],
        'zuk-hari': ['diozu', 0],
        'zuk-guri': ['diguzu', 0],
        'zuk-haiei': ['diezu', 0],
        'hark-niri': ['dit', 0],
        'hark-zuri': ['dit', 0]
      }
    };

    // Si quieres, agrega otros tiempos y verbos aqu√≠...

    // Etiquetas para mostrar
    const pronounLabels = {
      'nik-zuri': 'nik ‚Üí zuri',
      'nik-hari': 'nik ‚Üí hari',
      'nik-zuei': 'nik ‚Üí zuei',
      'nik-haiei': 'nik ‚Üí haiei',
      'zuk-niri': 'zuk ‚Üí niri',
      'zuk-hari': 'zuk ‚Üí hari',
      'zuk-guri': 'zuk ‚Üí guri',
      'zuk-haiei': 'zuk ‚Üí haiei',
      'hark-niri': 'hark ‚Üí niri',
      'hark-zuri': 'hark ‚Üí zuri',
    };

    // Variables estado ejercicio
    let currentVerb = null;
    let currentPairKey = null;

    // Errores guardados en localStorage
    let errors = JSON.parse(localStorage.getItem('errors')) || [];

    // Funciones ejercicio

    function getRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function startExercise() {
      menuSection.classList.add('hidden');
      errorsSection.classList.add('hidden');
      exerciseSection.classList.remove('hidden');
      nextQuestion();
    }

    function nextQuestion() {
      feedbackDiv.textContent = '';
      feedbackDiv.className = '';
      answerInput.value = '';
      nextButton.classList.add('hidden');
      answerInput.disabled = false;
      answerInput.focus();

      currentVerb = getRandom(Object.keys(s_present));
      const pairs = Object.keys(s_present[currentVerb]);
      currentPairKey = getRandom(pairs);

      questionDiv.textContent = `Verbo: "${currentVerb}"\nConjuga para: ${pronounLabels[currentPairKey] || currentPairKey}`;
    }

    function checkAnswer(e) {
      e.preventDefault();
      const userAnswer = answerInput.value.trim().toLowerCase();
      const correctAnswer = s_present[currentVerb][currentPairKey][0].toLowerCase();

      if (userAnswer === correctAnswer) {
        feedbackDiv.textContent = "¬°Correcto! üéâ";
        feedbackDiv.className = "correct";
        nextButton.classList.remove('hidden');
        answerInput.disabled = true;
      } else {
        feedbackDiv.textContent = `Incorrecto. La respuesta correcta es: "${correctAnswer}"`;
        feedbackDiv.className = "incorrect";

        // Guardar error para mostrar despu√©s
        errors.push({
          verbo: currentVerb,
          pronombres: pronounLabels[currentPairKey] || currentPairKey,
          respuestaCorrecta: correctAnswer,
          respuestaUsuario: userAnswer
        });
        localStorage.setItem('errors', JSON.stringify(errors));

        nextButton.classList.remove('hidden');
        answerInput.disabled = true;
      }
    }

    function showMenu() {
      exerciseSection.classList.add('hidden');
      errorsSection.classList.add('hidden');
      menuSection.classList.remove('hidden');
    }

    // Mostrar errores
    function showErrors() {
      menuSection.classList.add('hidden');
      exerciseSection.classList.add('hidden');
      errorsSection.classList.remove('hidden');

      errorList.innerHTML = '';
      if (errors.length === 0) {
        errorList.innerHTML = '<li>No has cometido errores a√∫n. ¬°Bien hecho!</li>';
      } else {
        errors.forEach((err, i) => {
          const li = document.createElement('li');
          li.textContent = `Verbo "${err.verbo}", ${err.pronombres}: respuesta correcta "${err.respuestaCorrecta}", t√∫ escribiste "${err.respuestaUsuario}"`;
          errorList.appendChild(li);
        });
      }
    }

    function clearErrors() {
      if (confirm('¬øSeguro que quieres borrar todos los errores?')) {
        errors = [];
        localStorage.removeItem('errors');
        showErrors();
      }
    }

    // Escuchar el submit de respuesta
    answerForm.addEventListener('submit', checkAnswer);

    // Escuchar click siguiente
    nextButton.addEventListener('click', nextQuestion);

    // Mostrar login al cargar si no hay usuario
    auth.onAuthStateChanged(user => {
      if (user) {
        loginRegisterSection.classList.add('hidden');
        menuSection.classList.remove('hidden');
      } else {
        loginRegisterSection.classList.remove('hidden');
        menuSection.classList.add('hidden');
        exerciseSection.classList.add('hidden');
        errorsSection.classList.add('hidden');
      }
    });
  </script>

</body>
</html>
