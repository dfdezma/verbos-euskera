<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Práctica de Verbos en Euskera</title>
  <style>
    /* ... (tu CSS igual) ... */
  </style>

  <!-- Firebase SDKs (versión compat para facilitar uso clásico) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <script>
    // Configura tu proyecto Firebase aquí:
    const firebaseConfig = {
      apiKey: "AIzaSyB8-aTOwO8w21ig0L21kfEded05ewEG3Wc",
      authDomain: "verboseuskeraapp.firebaseapp.com",
      projectId: "verboseuskeraapp",
      storageBucket: "verboseuskeraapp.firebasestorage.app",
      messagingSenderId: "1002538902447",
      appId: "1:1002538902447:web:b6d1f2795fef697d22c55a",
      measurementId: "G-83R58Q7B8J"
    };

    // Inicializa Firebase con SDK compat
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
  </script>
</head>

<body>
  <!-- Aquí va todo tu HTML: formularios, menú, ejercicio, etc. -->

  <!-- Ejemplo simple: -->
  <div id="login-register">
    <form id="loginForm" onsubmit="return loginUser(event)">
      <input id="loginUsername" type="email" placeholder="Email" required />
      <input id="loginPassword" type="password" placeholder="Contraseña" required />
      <button type="submit">Entrar</button>
      <div id="loginFeedback" style="color:red;"></div>
    </form>

    <form id="registerForm" class="hidden" onsubmit="return registerUser(event)">
      <input id="registerUsername" type="email" placeholder="Email" required />
      <input id="registerPassword" type="password" placeholder="Contraseña" required />
      <input id="registerPasswordConfirm" type="password" placeholder="Confirmar contraseña" required />
      <button type="submit">Registrar</button>
      <div id="registerFeedback" style="color:red;"></div>
    </form>
  </div>

  <div id="menu" class="hidden">
    <p>Bienvenido, <span id="currentUser"></span>!</p>
    <p>Racha actual: <span id="streak">0</span></p>
    <!-- Más botones y opciones aquí -->
    <button onclick="logout()">Cerrar sesión</button>
  </div>

  <div id="exercise" class="hidden">
    <p id="question"></p>
    <input type="text" id="answer" />
    <button onclick="checkAnswer()">Comprobar</button>
    <button onclick="nextQuestion()">Siguiente</button>
    <p id="feedback"></p>
    <button onclick="returnToMenu()">Volver al menú</button>
  </div>

  <div id="errors" class="hidden">
    <ul id="errorList"></ul>
    <button onclick="returnToMenu()">Volver al menú</button>
  </div>

  <div id="study" class="hidden">
    <h2>Tabla presente</h2>
    <div id="presentTable"></div>
    <h2>Tabla pasado</h2>
    <div id="pastTable"></div>
    <button onclick="returnToMenu()">Volver al menú</button>
  </div>

  <script>
    // Variables globales
    let currentSet = {};
    let currentKey = '';
    let streak = 0;
    let errors = {};
    let currentUser = null;

    // Mostrar formularios
    function showLogin() {
      document.getElementById('loginForm').classList.remove('hidden');
      document.getElementById('registerForm').classList.add('hidden');
    }

    function showRegister() {
      document.getElementById('registerForm').classList.remove('hidden');
      document.getElementById('loginForm').classList.add('hidden');
    }

    // Mostrar menú principal
    function showMenu() {
      document.getElementById('login-register').classList.add('hidden');
      document.getElementById('exercise').classList.add('hidden');
      document.getElementById('errors').classList.add('hidden');
      document.getElementById('study').classList.add('hidden');

      document.getElementById('menu').classList.remove('hidden');
      document.getElementById('currentUser').textContent = currentUser;
      updateStreak(0);
    }

    // Actualizar streak
    function updateStreak(newValue) {
      streak = newValue;
      document.getElementById('streak').textContent = streak;
    }

    // Inicio ejercicio
    function startExercise(type) {
      currentSet = (type === 'present') ? s_present : s_past;
      const keys = Object.keys(currentSet);
      currentKey = keys[Math.floor(Math.random() * keys.length)];
      document.getElementById('menu').classList.add('hidden');
      document.getElementById('errors').classList.add('hidden');
      document.getElementById('study').classList.add('hidden');
      document.getElementById('exercise').classList.remove('hidden');
      showQuestion();
      updateStreak(0);
    }

    // Mostrar pregunta
    function showQuestion() {
      document.getElementById('question').textContent = `Conjuga para: ${currentKey}`;
      document.getElementById('answer').value = '';
      document.getElementById('feedback').textContent = '';
      document.getElementById('answer').focus();
    }

    // Comprobar respuesta
    function checkAnswer() {
      const userAnswer = document.getElementById('answer').value.trim().toLowerCase();
      const correctAnswer = currentSet[currentKey].toLowerCase();

      if (!userAnswer) {
        alert('Por favor, escribe tu respuesta.');
        return;
      }

      const feedback = document.getElementById('feedback');
      if (userAnswer === correctAnswer) {
        feedback.textContent = '¡Correcto!';
        feedback.className = 'correct';
        updateStreak(streak + 1);
        delete errors[currentKey];
      } else {
        feedback.textContent = `Incorrecto. La respuesta correcta es: ${correctAnswer}`;
        feedback.className = 'incorrect';
        updateStreak(0);
        errors[currentKey] = correctAnswer;
      }
    }

    // Pasar a siguiente pregunta
    function nextQuestion() {
      const keys = Object.keys(currentSet);
      currentKey = keys[Math.floor(Math.random() * keys.length)];
      showQuestion();
    }

    // Volver al menú
    function returnToMenu() {
      document.getElementById('exercise').classList.add('hidden');
      document.getElementById('errors').classList.add('hidden');
      document.getElementById('study').classList.add('hidden');
      showMenu();
    }

    // Mostrar errores comunes
    function showErrors() {
      const ul = document.getElementById('errorList');
      ul.innerHTML = '';
      if (Object.keys(errors).length === 0) {
        ul.innerHTML = '<li>No hay errores registrados.</li>';
      } else {
        for (const [key, correct] of Object.entries(errors)) {
          const li = document.createElement('li');
          li.textContent = `${key}: ${correct}`;
          ul.appendChild(li);
        }
      }
      document.getElementById('menu').classList.add('hidden');
      document.getElementById('exercise').classList.add('hidden');
      document.getElementById('study').classList.add('hidden');
      document.getElementById('errors').classList.remove('hidden');
    }

    // Mostrar tabla de estudio
    function showStudy() {
      const presentTable = createTable(s_present);
      const pastTable = createTable(s_past);
      document.getElementById('presentTable').innerHTML = presentTable;
      document.getElementById('pastTable').innerHTML = pastTable;

      document.getElementById('menu').classList.add('hidden');
      document.getElementById('exercise').classList.add('hidden');
      document.getElementById('errors').classList.add('hidden');
      document.getElementById('study').classList.remove('hidden');
    }

    // Crear tabla HTML a partir de objeto conjugaciones
    function createTable(data) {
      let html = '<table><thead><tr><th>Persona</th><th>Conjugación</th></tr></thead><tbody>';
      for (const [key, value] of Object.entries(data)) {
        html += `<tr><td>${key}</td><td>${value}</td></tr>`;
      }
      html += '</tbody></table>';
      return html;
    }

    // Alternar mostrar/ocultar contraseña
    function togglePassword(inputId, btn) {
      const input = document.getElementById(inputId);
      if (input.type === 'password') {
        input.type = 'text';
        btn.title = 'Ocultar contraseña';
      } else {
        input.type = 'password';
        btn.title = 'Mostrar contraseña';
      }
    }

    // LOGIN con Firebase
    function loginUser(e) {
      e.preventDefault();
      const email = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          document.getElementById('loginFeedback').textContent = '';
          // currentUser se actualizará en el onAuthStateChanged
        })
        .catch(() => {
          document.getElementById('loginFeedback').textContent = 'Usuario o contraseña incorrectos.';
        });
      return false;
    }

    // REGISTRO con Firebase
    function registerUser(e) {
      e.preventDefault();
      const email = document.getElementById('registerUsername').value.trim();
      const password = document.getElementById('registerPassword').value;
      const confirm = document.getElementById('registerPasswordConfirm').value;

      if (password !== confirm) {
        document.getElementById('registerFeedback').textContent = 'Las contraseñas no coinciden.';
        return false;
      }

      if (password.length < 6) {
        document.getElementById('registerFeedback').textContent = 'La contraseña debe tener al menos 6 caracteres.';
        return false;
      }

      auth.createUserWithEmailAndPassword(email, password)
        .then(() => {
          document.getElementById('registerFeedback').textContent = '';
          // currentUser se actualizará en el onAuthStateChanged
        })
        .catch(error => {
          document.getElementById('registerFeedback').textContent = error.message;
        });

      return false;
    }

    // Logout Firebase
    function logout() {
      auth.signOut();
    }

    // Detectar cambios en el estado del usuario
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user.email;
        showMenu();
      } else {
        currentUser = null;
        document.getElementById('menu').classList.add('hidden');
        document.getElementById('exercise').classList.add('hidden');
        document.getElementById('errors').classList.add('hidden');
        document.getElementById('study').classList.add('hidden');
        document.getElementById('login-register').classList.remove('hidden');
        document.getElementById('loginFeedback').textContent = '';
        document.getElementById('registerFeedback').textContent = '';
      }
    });

    // Datos originales de conjugación
    const s_present = {
      "Ni": "dut",
      "Hi": "duk",
      "Hura": "du",
      "Gu": "ditugu",
      "Zuek": "duzue",
      "Haiek": "dute"
    };

    const s_past = {
      "Ni": "nuen",
      "Hi": "huken",
      "Hura": "zuen",
      "Gu": "genituen",
      "Zuek": "zenituzten",
      "Haiek": "zituen"
    };
  </script>

  <script>
    // Registrar Service Worker al final para que todo esté cargado
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('Service Worker registrado'))
        .catch(err => console.error('Error registrando Service Worker:', err));
    }
  </script>
</body>
</html>
