<!DOCTYPE html>
<html lang="eu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nor-Nori-Nork App</title>
  <style>
    body { font-family: sans-serif; text-align: center; background-color: #f0f0f5; margin: 0; padding: 0; }
    h1 { background-color: #333; color: white; padding: 1em; margin: 0; }
    .hidden { display: none; }
    input, button { padding: 0.5em; margin: 0.5em; font-size: 1em; }
    table { margin: 1em auto; border-collapse: collapse; }
    td, th { border: 1px solid #aaa; padding: 0.5em 1em; text-align: center; }
    th { background-color: #ddd; }
    .correct { color: green; font-weight: bold; }
    .incorrect { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Nor-Nori-Nork</h1>

  <div id="menu">
    <button onclick="startExercise('present')">Aditz Trinkoak - Oraina</button>
    <button onclick="startExercise('past')">Aditz Trinkoak - Iragana</button>
    <button onclick="showStudy()">Ikasi</button>
    <button onclick="showErrors()">Erroreak ikusi</button>
  </div>

  <div id="exercise" class="hidden">
    <h2 id="question"></h2>
    <input type="text" id="answer" placeholder="Idatzi hemen" />
    <button onclick="checkAnswer()">Bidali</button>
    <p id="feedback"></p>
    <p>Jarraian: <span id="streak">0</span></p>
    <button onclick="location.reload()">Itzuli</button>
  </div>

  <div id="errors" class="hidden">
    <h2>Erroreak</h2>
    <ul id="errorList"></ul>
    <button onclick="location.reload()">Itzuli</button>
  </div>

  <div id="study" class="hidden">
    <h2>Oraina</h2>
    <div id="presentTable"></div>
    <h2>Iragana</h2>
    <div id="pastTable"></div>
    <button onclick="location.reload()">Itzuli</button>
  </div>

  <script>
    let currentSet = {};
    let currentKey = '';
    let streak = 0;
    let errors = {};

    const s_present = {
      ["nik", "zuri"]: ["dizut", 0], ["nik", "hari"]: ["diot", 0], ["nik", "zuei"]: ["dizuet", 0],
      ["nik", "haiei"]: ["diet", 0], ["zuk", "niri"]: ["didazu", 0], ["zuk", "hari"]: ["diozu", 0],
      ["zuk", "guri"]: ["diguzu", 0], ["zuk", "haiei"]: ["diezu", 0], ["hark", "niri"]: ["dit", 0],
      ["hark", "zuri"]: ["dizu", 0], ["hark", "hari"]: ["dio", 0], ["hark", "guri"]: ["digu", 0],
      ["hark", "zuei"]: ["dizue", 0], ["hark", "haiei"]: ["die", 0], ["guk", "zuri"]: ["dizugu", 0],
      ["guk", "hari"]: ["diogu", 0], ["guk", "zuei"]: ["dizuegu", 0], ["guk", "haiei"]: ["diegu", 0],
      ["zuek", "niri"]: ["didazue", 0], ["zuek", "hari"]: ["diozue", 0], ["zuek", "guri"]: ["diguzue", 0],
      ["zuek", "haiei"]: ["diezue", 0], ["haiek", "niri"]: ["didate", 0], ["haiek", "zuri"]: ["dizute", 0],
      ["haiek", "hari"]: ["diote", 0], ["haiek", "guri"]: ["digute", 0], ["haiek", "zuei"]: ["dizuete", 0],
      ["haiek", "haiei"]: ["diete", 0]
    };

    const s_past = {
      ["nik", "zuri"]: ["nizum", 0], ["nik", "hari"]: ["nion", 0], ["nik", "zuei"]: ["nizuen", 0],
      ["nik", "haiei"]: ["nien", 0], ["zuk", "niri"]: ["zenidan", 0], ["zuk", "hari"]: ["zenion", 0],
      ["zuk", "guri"]: ["zenigun", 0], ["zuk", "haiei"]: ["zenien", 0], ["hark", "niri"]: ["zidan", 0],
      ["hark", "zuri"]: ["zizum", 0], ["hark", "hari"]: ["zion", 0], ["hark", "guri"]: ["zigun", 0],
      ["hark", "zuei"]: ["zizuen", 0], ["hark", "haiei"]: ["zien", 0], ["guk", "zuri"]: ["genizum", 0],
      ["guk", "hari"]: ["genion", 0], ["guk", "zuei"]: ["genizuen", 0], ["guk", "haiei"]: ["genien", 0],
      ["zuek", "niri"]: ["zenidaten", 0], ["zuek", "hari"]: ["zenioten", 0], ["zuek", "guri"]: ["zeniguten", 0],
      ["zuek", "haiei"]: ["zenieten", 0], ["haiek", "niri"]: ["zidaten", 0], ["haiek", "zuri"]: ["zizuten", 0],
      ["haiek", "hari"]: ["zioten", 0], ["haiek", "guri"]: ["ziguten", 0], ["haiek", "zuei"]: ["zizueten", 0],
      ["haiek", "haiei"]: ["zieten", 0]
    };

    const emisores = ["nik", "zuk", "hark", "guk", "zuek", "haiek"];
    const receptores = ["niri", "zuri", "hari", "guri", "zuei", "haiei"];

    function startExercise(type) {
      currentSet = type === 'present' ? s_present : s_past;
      const keys = Object.keys(currentSet);
      currentKey = keys[Math.floor(Math.random() * keys.length)];
      document.getElementById('menu').classList.add('hidden');
      document.getElementById('errors').classList.add('hidden');
      document.getElementById('study').classList.add('hidden');
      document.getElementById('exercise').classList.remove('hidden');
      showQuestion();
      updateStreak(0);
    }

    function showQuestion() {
      const [emisor, receptor] = currentKey.split(',');
      document.getElementById('question').textContent = `Conjuga "${emisor.trim()}" → "${receptor.trim()}"`;
      document.getElementById('answer').value = '';
      document.getElementById('feedback').textContent = '';
      document.getElementById('answer').focus();
    }

    function checkAnswer() {
      const userAnswer = document.getElementById('answer').value.trim().toLowerCase();
      const [correctAnswer, count] = currentSet[currentKey];
      const feedback = document.getElementById('feedback');

      if (userAnswer === correctAnswer.toLowerCase()) {
        feedback.textContent = '¡Correcto!';
        feedback.className = 'correct';
        updateStreak(streak + 1);
      } else {
        feedback.textContent = `Incorrecto. Respuesta correcta: ${correctAnswer}`;
        feedback.className = 'incorrect';
        updateStreak(0);

        currentSet[currentKey][1] += 1;
        errors[currentKey] = currentSet[currentKey];
      }

      const keys = Object.keys(currentSet);
      currentKey = keys[Math.floor(Math.random() * keys.length)];
      showQuestion();
    }

    function updateStreak(value) {
      streak = value;
      document.getElementById('streak').textContent = streak;
    }

    function showErrors() {
      const ul = document.getElementById('errorList');
      ul.innerHTML = '';
      if (Object.keys(errors).length === 0) {
        ul.innerHTML = '<li>Ez dago erroreak</li>';
      } else {
        for (const [key, [conjugacion, veces]] of Object.entries(errors)) {
          const [emisor, receptor] = key.split(',');
          const li = document.createElement('li');
          li.textContent = `${emisor.trim()} → ${receptor.trim()}: ${conjugacion} (erroreak: ${veces})`;
          ul.appendChild(li);
        }
      }
      document.getElementById('menu').classList.add('hidden');
      document.getElementById('exercise').classList.add('hidden');
      document.getElementById('study').classList.add('hidden');
      document.getElementById('errors').classList.remove('hidden');
    }

    function createTable(data) {
      let html = '<table><thead><tr><th></th>';
      for (const receptor of receptores) {
        html += `<th>${receptor}</th>`;
      }
      html += '</tr></thead><tbody>';

      for (const emisor of emisores) {
        html += `<tr><td><strong>${emisor}</strong></td>`;
        for (const receptor of receptores) {
          const key = `${emisor},${receptor}`;
          const value = data[key] ? data[key][0] : '-';
          html += `<td>${value}</td>`;
        }
        html += '</tr>';
      }
      html += '</tbody></table>';
      return html;
    }

    function showStudy() {
      document.getElementById('presentTable').innerHTML = createTable(s_present);
      document.getElementById('pastTable').innerHTML = createTable(s_past);
      document.getElementById('menu').classList.add('hidden');
      document.getElementById('exercise').classList.add('hidden');
      document.getElementById('errors').classList.add('hidden');
      document.getElementById('study').classList.remove('hidden');
    }
  </script>
</body>
</html>
