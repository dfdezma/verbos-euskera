<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pr√°ctica de Verbos en Euskera</title>

  <style>
    /* Reset b√°sico */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background: #f5f7fa;
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1, h2 {
      margin-bottom: 20px;
      color: #2c3e50;
      text-align: center;
    }
    .hidden { display: none; }
    #login-register, #menu, #exercise, #errors, #study {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 20px;
      width: 320px;
      max-width: 95vw;
      margin-bottom: 20px;
    }
    form {
      display: flex;
      flex-direction: column;
    }
    label {
      margin-bottom: 5px;
      font-weight: 600;
      color: #34495e;
    }
    input[type="email"], input[type="password"], input[type="text"] {
      padding: 8px 12px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      transition: border-color 0.3s ease;
    }
    input[type="email"]:focus, input[type="password"]:focus, input[type="text"]:focus {
      outline: none;
      border-color: #2980b9;
    }
    button, input[type="submit"] {
      background-color: #2980b9;
      color: white;
      border: none;
      padding: 10px 15px;
      margin-top: 8px;
      border-radius: 5px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover, input[type="submit"]:hover {
      background-color: #1f618d;
    }
    button.secondary {
      background-color: #95a5a6;
      margin-left: 10px;
    }
    button.secondary:hover {
      background-color: #7f8c8d;
    }
    .feedback {
      font-size: 0.9rem;
      margin-top: -10px;
      margin-bottom: 15px;
      color: #e74c3c;
      min-height: 18px;
    }
    .feedback.correct {
      color: #27ae60;
    }
    .password-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }
    .password-wrapper input {
      flex-grow: 1;
    }
    .password-wrapper button {
      position: absolute;
      right: 8px;
      background: none;
      border: none;
      cursor: pointer;
      color: #2980b9;
      font-size: 1.1rem;
      padding: 0;
    }
    #menu p {
      margin-bottom: 15px;
      font-weight: 600;
      text-align: center;
      font-size: 1.1rem;
    }
    #menu button {
      width: 100%;
      margin-bottom: 10px;
    }
    #exercise #question {
      font-size: 1.2rem;
      margin-bottom: 15px;
      text-align: center;
      font-weight: 600;
      color: #2c3e50;
    }
    #exercise input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      margin-bottom: 12px;
    }
    #feedback {
      min-height: 24px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 15px;
    }
    #feedback.correct {
      color: #27ae60;
    }
    #feedback.incorrect {
      color: #e74c3c;
    }
    #errorList {
      list-style: inside disc;
      color: #34495e;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
      font-size: 0.95rem;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #2980b9;
      color: white;
    }
    tbody tr:nth-child(even) {
      background-color: #f9f9f9;
    }
  </style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB8-aTOwO8w21ig0L21kfEded05ewEG3Wc",
      authDomain: "verboseuskeraapp.firebaseapp.com",
      projectId: "verboseuskeraapp",
      storageBucket: "verboseuskeraapp.appspot.com",
      messagingSenderId: "1002538902447",
      appId: "1:1002538902447:web:b6d1f2795fef697d22c55a",
      measurementId: "G-83R58Q7B8J"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
  </script>
</head>
<body>

  <h1>Pr√°ctica de Verbos en Euskera</h1>

  <section id="login-register">
    <form id="loginForm" onsubmit="return loginUser(event)">
      <h2>Iniciar sesi√≥n</h2>
      <label for="loginUsername">Correo electr√≥nico</label>
      <input type="email" id="loginUsername" required placeholder="tu@email.com" />
      <label for="loginPassword">Contrase√±a</label>
      <div class="password-wrapper">
        <input type="password" id="loginPassword" required placeholder="Contrase√±a" />
        <button type="button" title="Mostrar contrase√±a" onclick="togglePassword('loginPassword', this)">üëÅÔ∏è</button>
      </div>
      <input type="submit" value="Entrar" />
      <p class="feedback" id="loginFeedback"></p>
      <p>¬øNo tienes cuenta? <button type="button" onclick="showRegister()" class="secondary">Reg√≠strate</button></p>
    </form>

    <form id="registerForm" class="hidden" onsubmit="return registerUser(event)">
      <h2>Registrarse</h2>
      <label for="registerUsername">Correo electr√≥nico</label>
      <input type="email" id="registerUsername" required placeholder="tu@email.com" />
      <label for="registerPassword">Contrase√±a</label>
      <div class="password-wrapper">
        <input type="password" id="registerPassword" required placeholder="Contrase√±a" />
        <button type="button" title="Mostrar contrase√±a" onclick="togglePassword('registerPassword', this)">üëÅÔ∏è</button>
      </div>
      <label for="registerPasswordConfirm">Confirmar contrase√±a</label>
      <div class="password-wrapper">
        <input type="password" id="registerPasswordConfirm" required placeholder="Repite la contrase√±a" />
        <button type="button" title="Mostrar contrase√±a" onclick="togglePassword('registerPasswordConfirm', this)">üëÅÔ∏è</button>
      </div>
      <input type="submit" value="Registrar" />
      <p class="feedback" id="registerFeedback"></p>
      <p>¬øYa tienes cuenta? <button type="button" onclick="showLogin()" class="secondary">Inicia sesi√≥n</button></p>
    </form>
  </section>

  <section id="menu" class="hidden">
    <p>¬°Bienvenido! Selecciona una opci√≥n:</p>
    <button onclick="startExercise()">Practicar Conjugaciones</button>
    <button onclick="showErrors()">Mostrar Errores</button>
    <button onclick="logout()">Cerrar sesi√≥n</button>
  </section>

  <section id="exercise" class="hidden" aria-live="polite">
    <h2>Ejercicio de Conjugaci√≥n</h2>
    <div id="question"></div>
    <form id="answerForm" onsubmit="return checkAnswer(event)">
      <input type="text" id="answerInput" placeholder="Escribe la conjugaci√≥n correcta" autocomplete="off" required />
      <input type="submit" value="Comprobar" />
    </form>
    <div id="feedback" role="alert"></div>
    <button id="nextButton" class="hidden" onclick="nextQuestion()">Siguiente</button>
    <button onclick="finishExercise()">Terminar ejercicio</button>
  </section>

  <section id="errors" class="hidden" aria-live="polite">
    <h2>Errores cometidos</h2>
    <ul id="errorList"></ul>
    <button onclick="clearErrors()">Borrar errores</button>
    <button onclick="backToMenu()">Volver al men√∫</button>
  </section>

  <section id="study" class="hidden" aria-live="polite">
    <h2>Lista de verbos y conjugaciones</h2>
    <table>
      <thead>
        <tr><th>Verbo</th><th>Pronombres</th><th>Conjugaci√≥n</th><th>Errores</th></tr>
      </thead>
      <tbody id="studyTableBody"></tbody>
    </table>
    <button onclick="backToMenu()">Volver al men√∫</button>
  </section>

  <script>
    // --- Datos de conjugaci√≥n ---
    const s_present = {
      'izan': {
        'nik-zuri': ['naiz', 0],
        'hik-zuk': ['haiz', 0],
        'hark-hark': ['da', 0],
        'gu-zuek': ['gara', 0],
        'zuek-zuek': ['zarete', 0],
        'haiek-haiek': ['dira', 0]
      },
      'etorri': {
        'nik-zuri': ['nator', 0],
        'hik-zuk': ['hator', 0],
        'hark-hark': ['dator', 0],
        'gu-zuek': ['gatoz', 0],
        'zuek-zuek': ['zatozte', 0],
        'haiek-haiek': ['datoz', 0]
      }
    };

    const s_past = {
      'izan': {
        'nik-zuri': ['nintzen', 0],
        'hik-zuk': ['hintzen', 0],
        'hark-hark': ['zen', 0],
        'gu-zuek': ['ginen', 0],
        'zuek-zuek': ['zineten', 0],
        'haiek-haiek': ['ziren', 0]
      },
      'etorri': {
        'nik-zuri': ['nentorren', 0],
        'hik-zuk': ['hentorren', 0],
        'hark-hark': ['zetorren', 0],
        'gu-zuek': ['gentozen', 0],
        'zuek-zuek': ['zentozten', 0],
        'haiek-haiek': ['zetozen', 0]
      }
    };

    // Frases para mostrar los pronombres m√°s legibles
    const pronounLabels = {
      'nik-zuri': 'nik - zuri',
      'hik-zuk': 'hik - zuk',
      'hark-hark': 'hark',
      'gu-zuek': 'gu - zuek',
      'zuek-zuek': 'zuek',
      'haiek-haiek': 'haiek'
    };

    let currentVerb = null;
    let currentTense = null;
    let currentPairKey = null;
    let streak = 0;
    let errors = [];

    // --- Elementos DOM ---
    const loginRegisterSection = document.getElementById('login-register');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const loginFeedback = document.getElementById('loginFeedback');
    const registerFeedback = document.getElementById('registerFeedback');
    const menuSection = document.getElementById('menu');
    const exerciseSection = document.getElementById('exercise');
    const questionDiv = document.getElementById('question');
    const answerForm = document.getElementById('answerForm');
    const answerInput = document.getElementById('answerInput');
    const feedbackDiv = document.getElementById('feedback');
    const nextButton = document.getElementById('nextButton');
    const errorsSection = document.getElementById('errors');
    const errorList = document.getElementById('errorList');
    const studySection = document.getElementById('study');
    const studyTableBody = document.getElementById('studyTableBody');

    // --- Funciones UI ---
    function showRegister() {
      loginForm.classList.add('hidden');
      registerForm.classList.remove('hidden');
      loginFeedback.textContent = '';
      registerFeedback.textContent = '';
    }
    function showLogin() {
      registerForm.classList.add('hidden');
      loginForm.classList.remove('hidden');
      loginFeedback.textContent = '';
      registerFeedback.textContent = '';
    }

    function togglePassword(inputId, btn) {
      const input = document.getElementById(inputId);
      if (input.type === 'password') {
        input.type = 'text';
        btn.textContent = 'üôà';
      } else {
        input.type = 'password';
        btn.textContent = 'üëÅÔ∏è';
      }
    }

    // --- Firebase Auth ---
    async function loginUser(event) {
      event.preventDefault();
      loginFeedback.textContent = '';
      const email = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;
      try {
        await auth.signInWithEmailAndPassword(email, password);
        loginRegisterSection.classList.add('hidden');
        menuSection.classList.remove('hidden');
      } catch (error) {
        loginFeedback.textContent = "Error: " + error.message;
      }
    }

    async function registerUser(event) {
      event.preventDefault();
      registerFeedback.textContent = '';
      const email = document.getElementById('registerUsername').value.trim();
      const password = document.getElementById('registerPassword').value;
      const confirmPassword = document.getElementById('registerPasswordConfirm').value;
      if (password !== confirmPassword) {
        registerFeedback.textContent = 'Las contrase√±as no coinciden.';
        return;
      }
      try {
        await auth.createUserWithEmailAndPassword(email, password);
        registerFeedback.textContent = 'Usuario registrado correctamente, por favor inicia sesi√≥n.';
        setTimeout(() => showLogin(), 2000);
      } catch (error) {
        registerFeedback.textContent = "Error: " + error.message;
      }
    }

    function logout() {
      auth.signOut();
      menuSection.classList.add('hidden');
      exerciseSection.classList.add('hidden');
      errorsSection.classList.add('hidden');
      studySection.classList.add('hidden');
      loginRegisterSection.classList.remove('hidden');
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        loginRegisterSection.classList.add('hidden');
        menuSection.classList.remove('hidden');
      } else {
        loginRegisterSection.classList.remove('hidden');
        menuSection.classList.add('hidden');
        exerciseSection.classList.add('hidden');
        errorsSection.classList.add('hidden');
        studySection.classList.add('hidden');
      }
    });

    // --- Ejercicio ---

    // Elegir verbo y pronombre al azar
    function getRandom(array) {
      return array[Math.floor(Math.random() * array.length)];
    }

    function startExercise() {
      menuSection.classList.add('hidden');
      errorsSection.classList.add('hidden');
      studySection.classList.add('hidden');
      exerciseSection.classList.remove('hidden');
      streak = 0;
      nextQuestion();
    }

    function nextQuestion() {
      feedbackDiv.textContent = '';
      feedbackDiv.className = '';
      answerInput.value = '';
      nextButton.classList.add('hidden');
      answerInput.disabled = false;
      answerInput.focus();

      // Escoger aleatoriamente entre presente y pasado
      currentTense = getRandom(['present', 'past']);
      // Escoger verbo
      const verbs = currentTense === 'present' ? Object.keys(s_present) : Object.keys(s_past);
      currentVerb = getRandom(verbs);

      // Escoger pronombre par (key)
      const pronounKeys = currentTense === 'present' ? Object.keys(s_present[currentVerb]) : Object.keys(s_past[currentVerb]);
      currentPairKey = getRandom(pronounKeys);

      // Mostrar pregunta
      const pronLabel = pronounLabels[currentPairKey] || currentPairKey;
      const tenseLabel = currentTense === 'present' ? 'Presente' : 'Pasado';
      questionDiv.textContent = `Verbo: "${currentVerb}" - Tiempo: ${tenseLabel}\nConjuga para: ${pronLabel}`;
    }

    function checkAnswer(event) {
      event.preventDefault();
      const userAnswer = answerInput.value.trim().toLowerCase();
      let correctAnswer;
      if (currentTense === 'present') {
        correctAnswer = s_present[currentVerb][currentPairKey][0].toLowerCase();
      } else {
        correctAnswer = s_past[currentVerb][currentPairKey][0].toLowerCase();
      }

      if (userAnswer === correctAnswer) {
        feedbackDiv.textContent = "¬°Correcto! üéâ";
        feedbackDiv.className = 'correct';
        streak++;
        nextButton.classList.remove('hidden');
        answerInput.disabled = true;
      } else {
        feedbackDiv.textContent = `Incorrecto. La respuesta correcta es: "${correctAnswer}"`;
        feedbackDiv.className = 'incorrect';
        streak = 0;
        // Registrar error
        const errorEntry = {
          verb: currentVerb,
          tense: currentTense,
          pronouns: pronounLabels[currentPairKey] || currentPairKey,
          correct: correctAnswer,
          given: userAnswer
        };
        errors.push(errorEntry);
        // Incrementar contador en datos
        if (currentTense === 'present') {
          s_present[currentVerb][currentPairKey][1]++;
        } else {
          s_past[currentVerb][currentPairKey][1]++;
        }
        nextButton.classList.remove('hidden');
        answerInput.disabled = true;
      }
    }

    nextButton.addEventListener('click', nextQuestion);

    function finishExercise() {
      exerciseSection.classList.add('hidden');
      menuSection.classList.remove('hidden');
    }

    // --- Mostrar errores ---
    function showErrors() {
      menuSection.classList.add('hidden');
      exerciseSection.classList.add('hidden');
      studySection.classList.add('hidden');
      errorsSection.classList.remove('hidden');
      errorList.innerHTML = '';
      if (errors.length === 0) {
        errorList.innerHTML = '<li>No hay errores registrados.</li>';
      } else {
        for (const err of errors) {
          const li = document.createElement('li');
          li.textContent = `"${err.verb}" (${err.tense}), pronombres ${err.pronouns}: respuesta correcta "${err.correct}", t√∫ pusiste "${err.given}"`;
          errorList.appendChild(li);
        }
      }
    }

    function clearErrors() {
      if (confirm('¬øSeguro que quieres borrar todos los errores?')) {
        errors.length = 0;
        // Resetear contadores tambi√©n
        for (const verb in s_present) {
          for (const pair in s_present[verb]) {
            s_present[verb][pair][1] = 0;
          }
        }
        for (const verb in s_past) {
          for (const pair in s_past[verb]) {
            s_past[verb][pair][1] = 0;
          }
        }
        showErrors();
      }
    }

    function backToMenu() {
      errorsSection.classList.add('hidden');
      studySection.classList.add('hidden');
      menuSection.classList.remove('hidden');
    }

    // --- Mostrar estudio de verbos ---
    function showStudy() {
      menuSection.classList.add('hidden');
      errorsSection.classList.add('hidden');
      exerciseSection.classList.add('hidden');
      studySection.classList.remove('hidden');
      studyTableBody.innerHTML = '';

      // Present
      for (const verb in s_present) {
        for (const pair in s_present[verb]) {
          const [conjugation, count] = s_present[verb][pair];
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${verb}</td><td>${pronounLabels[pair]}</td><td>${conjugation}</td><td>${count}</td>`;
          studyTableBody.appendChild(tr);
        }
      }
      // Past
      for (const verb in s_past) {
        for (const pair in s_past[verb]) {
          const [conjugation, count] = s_past[verb][pair];
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${verb}</td><td>${pronounLabels[pair]}</td><td>${conjugation}</td><td>${count}</td>`;
          studyTableBody.appendChild(tr);
        }
      }
    }

  </script>
</body>
</html>
